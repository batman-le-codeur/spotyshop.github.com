<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="spotylogo.svg" type="image/x-icon">
    <title>Inscription code promo</title>
    <style>
        .container {
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #1DB954;
            font-size: 40px;
        }
        
        .form-group { margin-bottom: 20px; }
        
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background-color: #1DB954;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: none;
            text-align: center;
        }
        
        .success { background-color: #d4edda; color: #2c8e43; }
        .error   { background-color: #f8d7da; color: #ff0019; }

        /* === Loader (ajout) === */
        .loader-overlay {
            display: none;               /* IMPORTANT: caché par défaut */
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loader {
            border: 4px solid rgba(0,0,0,0.1);
            border-left-color: #1DB954;
            border-radius: 50%;
            width: 36px; height: 36px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

<!-- Navbar -->
<header>
    <nav class="navbar">
        <div class="logo">
            <img src="spotylogo.svg" alt="Logo SpotyShop">
            <span>potyShop</span>
        </div>

        <ul class="nav-links">
            <li><a href="index.html">Accueil</a></li>
            <li><a href="service.html">Produits</a></li>
            <li><a href="index.html#apropos">À propos</a></li>
            <li><a href="dashboard.html">Activités</a></li>
            <li><a class="contact-btn" href="https://wa.me/24107425535">Contact</a></li>
        </ul>

        <div class="menu-toggle" id="menu-toggle">&#9776;</div>
    </nav>
</header>

<!-- Sidebar mobile -->
<div class="sidebar" id="sidebar">
    <div class="close-btn" id="close-btn">&times;</div>
    <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="service.html">Produits</a></li>
        <li><a href="index.html#apropos">À propos</a></li>
        <li><a href="dashboard.html">Activités</a></li>
        <li><a href="https://wa.me/24107425535" class="contact-btn">Contact</a></li>
    </ul>
</div>

<div class="centered-wrapper">
    <div class="container" style="max-width:600px; width:100%;">
        <h2>Creation du code promo</h2>
        <form id="form">
            <div class="form-group">
                <label for="nom">Nom</label>
                <input type="text" id="nom" required>
            </div>
            <div class="form-group">
                <label for="numero">Numéro de Tel</label>
                <input type="tel" id="numero" placeholder="Numéro: sans le 0 au debut" pattern="[0-9]*" inputmode="numeric" maxlength="15" autocomplete="off"
        oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            </div>
            <div class="form-group">
                <label for="code">Code souhaité</label>
                <input type="text" id="code" required>
            </div>
            <div class="message success" id="success">Inscription réussie !</div>
            <div class="message error" id="error">Erreur lors de l'inscription</div>
            <button type="submit" id="submitBtn">S'inscrire</button>
        </form>
    </div>
</div>

<!-- Loader (ajout) -->
<div class="loader-overlay" id="loader" aria-hidden="true">
    <div class="loader" aria-label="Chargement"></div>
</div>

<style>
.centered-wrapper {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
}
.container { max-width: 600px; width: 100%; }
@media (max-width: 700px) {
    .container { max-width: 100%; padding: 16px; }
}
</style>

<h2 style="margin-bottom: 30px;">Comment ça marche ?</h2>

<div class="accordion">
    <div class="accordion-item">
        <button class="accordion-header" type="button">
            <h3>C'est quoi le code promo ?</h3>
        </button>
        <div class="accordion-content">
            <p>
                Le code promo est un identifiant unique que vous créez et partagez avec d'autres personnes. À chaque fois qu'une personne utilise votre code lors de son achat, vous gagnez de l'argent. Plus votre code est utilisé, plus vos gains augmentent !
            </p>
        </div>
    </div>
    <div class="accordion-item">
        <button class="accordion-header" type="button">
            <h3>Combien raporte le code promo ?</h3>
        </button>
        <div class="accordion-content">
            <p>
                Le code promo peut vous rapporter entre 200 FCFA et 1000 FCFA par vente, selon le produit acheté par votre filleul. Pour tous les abonnements mensuels, chaque vente réalisée avec votre code vous rapporte systématiquement 200 FCFA.
            </p>
        </div>
    </div>
    <div class="accordion-item">
        <button class="accordion-header" type="button">
            <h3>Comment recevoir mes gains ?</h3>
        </button>
        <div class="accordion-content">
            <p>
                Pour recevoir vos gains, vous devez avoir accumulé au moins 1000 FCFA. Vous pouvez suivre le montant que vous avez généré à tout moment sur la page <a href="dashboard.html" style="color:#1DB954;text-decoration:underline;">Activités</a>. Une fois ce seuil atteint, contactez-nous via WhatsApp ou par email pour demander le paiement de vos commissions.
            </p>
        </div>
    </div>
</div>

<style>
.accordion { width: 100%; max-width: 600px; margin: 32px auto; }
.accordion-item { margin-bottom: 12px; border-radius: 6px; overflow: hidden; background: rgba(0,0,0,0.1); }
.accordion-header {
    width: 100%; background: rgba(0,0,0,0.1); border: none; outline: none; cursor: pointer;
    padding: 0; display: flex; align-items: center;
}
.accordion-header h3 {
    color: #1DB954; margin: 0; padding: 18px 24px; font-size: 1.2rem; flex: 1;
}
.accordion-content {
    display: none; color: #fff; background: rgba(0,0,0,0.1);
    padding: 20px 24px; font-size: 1rem; animation: fadeIn 0.3s;
}
.accordion-item.active .accordion-content { display: block; }
@media (max-width: 700px) {
    .accordion { max-width: 100%; }
    .accordion-content, .accordion-header h3 { padding-left: 12px; padding-right: 12px; }
    .accordion-header h3 { text-align: center; width: 100%; }
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>

<script>
document.querySelectorAll('.accordion-header').forEach(header => {
    header.addEventListener('click', function() {
        const item = this.parentElement;
        const isActive = item.classList.contains('active');
        document.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('active'));
        if (!isActive) item.classList.add('active');
    });
});
</script>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
      <div class="footer-desc">
        <h3>SpotyShop</h3>
        <p>Location d'abonnements Spotify Premium à prix réduit.</p>
      </div>
      <div class="footer-nav">
        <h4>Navigation</h4>
        <a href="#accueil">Accueil</a>
        <a href="#services">Produits</a>
        <a href="#apropos">À propos</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-links">
        <h4>Suivez-nous</h4>
        <a href="#">Facebook</a>
        <a href="#">Instagram</a>
        <a href="#">Twitter</a>
      </div>
    </div>
    <p class="footer-bottom">&copy; 2025 SpotyShop - Tous droits réservés</p>
</footer>

<script src="script.js"></script>
<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwMIDEcgFdsGcISE0sKFphyx1ELJ3sr7lLpmeTP7yAjN91nQgJcsyQnYJohrPBx0EVN/exec';

const form      = document.getElementById('form');
const loaderEl  = document.getElementById('loader');
const successEl = document.getElementById('success');
const errorEl   = document.getElementById('error');

form.addEventListener('submit', async function(e) {
    e.preventDefault();

    // Affiche le loader UNIQUEMENT au clic
    loaderEl.style.display = 'flex';
    successEl.style.display = 'none';
    errorEl.style.display = 'none';

    const data = {
        action: 'create',
        nom: document.getElementById('nom').value,
        numero: document.getElementById('numero').value,
        code: document.getElementById('code').value
    };

    try {
        const res = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });

        // Tente de lire le JSON (si backend renvoie du JSON)
        let payload = {};
        try { payload = await res.json(); } catch (_) {}

        if (res.ok && (payload.success === true || payload.message)) {
            successEl.style.display = 'block';
            form.reset();
        } else {
            errorEl.textContent = (payload && payload.message) ? payload.message : "Erreur lors de l'inscription";
            errorEl.style.display = 'block';
        }
    } catch (err) {
        errorEl.textContent = "Erreur réseau ou serveur";
        errorEl.style.display = 'block';
    } finally {
        // Cache le loader quoi qu’il arrive
        loaderEl.style.display = 'none';
    }
});
</script>

</html>
