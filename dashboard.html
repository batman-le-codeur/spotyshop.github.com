<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Recherche affilié</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f8f9fa;
  }
  form {
    margin-bottom: 20px;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  input, button {
    padding: 8px;
    margin: 5px 0;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  button {
    background: #007BFF;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #0056b3;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  th, td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
  }
  th {
    background: #007BFF;
    color: white;
  }
</style>
</head>
<body>

<h1>Recherche affilié</h1>

<form id="searchForm">
  <label>Nom :</label>
  <input type="text" id="nom" required>

  <label>Numéro :</label>
  <input type="text" id="numero" required>

  <button type="submit">Rechercher</button>
</form>

<table id="resultTable" style="display:none;">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Téléphone</th>
      <th>Code promo</th>
      <th>Gains</th>
    </tr>
  </thead>
  <tbody id="resultBody"></tbody>
</table>

<p id="message" style="color:red;"></p>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbydVe8BqKScT2mw3hYMCXUr85DICtzhOXwg6f105YXkiYCZCUvMpWfe1FyGkl3IupC6/exec"; // Remplace par ton URL Apps Script

document.getElementById("searchForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const nom = document.getElementById("nom").value.trim();
  const numero = document.getElementById("numero").value.trim();
  const messageEl = document.getElementById("message");
  const resultTable = document.getElementById("resultTable");
  const resultBody = document.getElementById("resultBody");

  messageEl.textContent = "Recherche en cours...";
  resultTable.style.display = "none";

  fetch(apiUrl, {
    method: "POST",
    body: JSON.stringify({
      action: "search",
      nom: nom,
      numero: numero
    }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      messageEl.textContent = "";
      resultBody.innerHTML = `
        <tr>
          <td>${data.affiliate.nom}</td>
          <td>${data.affiliate.numero}</td>
          <td>${data.affiliate.code}</td>
          <td>${data.affiliate.gains}</td>
        </tr>
      `;
      resultTable.style.display = "table";
    } else {
      messageEl.textContent = data.message || "Aucun affilié trouvé";
    }
  })
  .catch(err => {
    console.error(err);
    messageEl.textContent = "Erreur de connexion au serveur.";
  });
});
</script>

</body>
</html>
